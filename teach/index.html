<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>AlphaZero Qubic 4√ó4√ó4 ‚Äî MCTS Explainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/helvetica-neue-5" rel="stylesheet">

  <!-- ONNX Runtime -->
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
  <script>
    // Configure WASM - disable threading to avoid JSEP issues
    ort.env.wasm.numThreads = 1;
    ort.env.wasm.simd = true;
    // Disable WebGPU to avoid JSEP compatibility issues
    ort.env.webgpu = { disabled: false };
  </script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="./src/styles.css" />
</head>

<body>
   <!-- hero -->
   <section id="hero">
     <div id="hero-bg"></div>
     <div class="hero-content">
       <h1>AlphaToe</h1>
       <p class="subtitle">AlphaZero on Tic-Tac-Toe</p>
     </div>
   </section>

   <!-- qubic game board -->
   <section id="qubic-game-board" class="snap-section">
     <div class="section-content-wide">
      <div class="intro-container">
        <div class="intro-text">
          <h2>See what it can do</h2>
          <h3>3D Tic-Tac-Toe</h3>
          <div class="explanation">
            <p>Unlike 2D Tic-Tac-Toe played on a 3√ó3 grid, this is played on a 4√ó4√ó4 cube.</br>
            You can win by getting four in a row horizontally, vertically, or diagonally, </br>
            but across all three dimensions. This creates 76 possible winning lines instead </br>
            of just 8, making it a much more complex and strategic game.</p>
          </div>
        </div>
        <div id="qubic-animation"></div>
      </div>

       <div id="game-container">
         <section class="card" id="boards-wrap">
           <div id="startOverlay">
             <h2 style="text-align:center; height:2em; line-height:2em; margin:0;">Who starts first?</h2>
             <div style="display:flex; gap:20px; justify-content:center;">
               <button id="humanStart" style="text-align:center;">I start</button>
               <button id="aiStart" style="text-align:center;">AI starts</button>
             </div>
           </div>
           <div id="boards">
             <canvas id="board0" class="board" width="800" height="800"></canvas>
             <canvas id="board1" class="board" width="800" height="800"></canvas>
             <canvas id="board2" class="board" width="800" height="800"></canvas>
             <canvas id="board3" class="board" width="800" height="800"></canvas>
           </div>
           <div id="gameOverOverlay">
             <h2 id="gameOverText"></h2>
             <button id="restartGame">Play Again</button>
           </div>

           <div id="cell-tooltip" class="cell-tooltip"></div>
           <div id="cell-highlight" class="cell-highlight"></div>

           <div class="controls" style="margin-top:8px;">
             <div class="row-inline">
               <div id="aiStatus">
                 <span id="aiLabel">AI</span>
                 <span id="aiStatusText">Waiting</span>
               </div>
               <button id="run">Ask AI to help you</button>
               <button id="reset">Reset</button>
             </div>
           </div>

           <div class="parameters-section">
             <div class="parameters-title">Parameters</div>
             <div class="parameter-row">
               <span class="parameter-label"># simulations:</span>
               <span class="mono parameter-value" id="simsVal">1000</span>
             </div>
             <div class="parameter-row">
               <span class="parameter-label">c_puct:</span>
               <span class="mono parameter-value" id="cpuctVal">1.00</span>
             </div>
             <div class="parameter-row">
               <span class="parameter-label">Temperature œÑ:</span>
               <span class="mono parameter-value" id="tempVal">0.00</span>
             </div>
             <div class="parameter-row">
               <span class="parameter-label">Dirichlet Œµ:</span>
               <span class="mono parameter-value" id="epsVal">0.00</span>
             </div>
             <div class="parameter-row">
               <span class="parameter-label">Dirichlet Œ±:</span>
               <span class="mono parameter-value" id="alphaVal">0.30</span>
             </div>
           </div>
         </section>

        </div>
     </div>
   </section>

  <!-- Load application modules -->
     </section>

     <!-- Components -->
     <section id="components" class="snap-section">
       <div class="section-content">
         <h2>Three things to know about AlphaZero</h2>
          <div class="info-cards">
            <div class="info-card">
              <h3>Œ±MCTS</h3>
              <div class="card-image">
                <!-- inline or external SVG for Œ±MCTS -->
                <img src="./assets/alpha-mcts.svg" alt="Œ±MCTS ‚Äî Alpha Monte Carlo Tree Search" style="width:100%; object-fit:contain;" />
              </div>
              <div class="card-content">
                <p>ùõºMCTS (AlphaZero's Variant of Monte Carlo Tree Search) is mixture of the vanilla MCTS guided by two neural networks: policy network that suggests actions;value network that evaluates(scores) state. 
MCTS is a method to tranverse the game tree (tree of states and actions) to find the next best action.
</p>
              </div>
            </div>
            <div class="info-card">
              <h3>Neural Network</h3>
              <div class="card-image">
                <img src="./assets/neural-net.svg" alt="Neural Network" style="width:100%; object-fit:contain;" />
              </div>
              <div class="card-content">
                <p>The NN evaluates board positions and predicts move probabilities, learning from self-play games to improve decision-making.</p>
              </div>
            </div>
            <div class="info-card">
              <h3>Self-Play</h3>
              <div class="card-image"></div>
              <div class="card-content">
                <p>The AI plays against itself millions of times, generating training data to learn optimal strategies without human intervention.</p>
              </div>
            </div>
          </div>
       </div>
     </section>
   </main>

  <!-- Load application modules -->
  <script type="module">
    import { init } from './src/app.js';
    import { initQubicAnimation } from './src/qubic-animation.js';
    import { initHeroAnimation } from './src/hero-animation.js';
    
    init();
    initQubicAnimation();
    initHeroAnimation();
  </script>
</body>

  <script>
    // Inline neural-net.svg and randomize edge animation delays so edges draw in random order
    (function inlineAndRandomize(){
      const selector = '.info-card .card-image img[alt="Neural Network"]';
      const img = document.querySelector(selector);
      if(!img) return;
      fetch(img.src).then(r=>r.text()).then(svgText=>{
        const wrapper = document.createElement('div');
        wrapper.innerHTML = svgText;
        const svg = wrapper.querySelector('svg');
        if(!svg) return;

        // remove width/height attributes so SVG scales with container
        svg.removeAttribute('width'); svg.removeAttribute('height');

        // randomize animation delays for animated overlay paths
        // left->mid edges should start after left nodes; mid->right after middle nodes
        const leftBase = 900; // ms after left nodes appear
        const midBase = 2500; // ms after middle nodes appear
        const paths = svg.querySelectorAll('path');
        // randomly drop ~50% of edges to create sparse connections
        const keepProbability = 0.5;
        const kept = [];
        paths.forEach((p)=>{
          if(Math.random() > keepProbability){
            // remove the path from the SVG to drop the edge
            p.parentNode.removeChild(p);
            return;
          }
          kept.push(p);
        });

        // apply randomized animation delay and stroke width to kept paths
        kept.forEach((p)=>{
          p.classList.add('conn-anim');
          const isMidRight = p.classList.contains('m');
          const base = isMidRight ? midBase : leftBase;
          const rnd = Math.random() * 1200; // up to 1.2s random offset
          p.style.animationDelay = (base + rnd)/1000 + 's';
          const w = 0.9 + Math.random() * 0.9;
          p.style.strokeWidth = w.toFixed(2) + 'px';
        });

        // place the SVG inline replacing the <img>
        img.parentNode.replaceChild(svg, img);
      }).catch(()=>{});
    })();
  </script>

